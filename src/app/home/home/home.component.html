<div class="mb-8">

  <app-search
    (eventClicked)="editEvent($event)"
  ></app-search>

  <app-calendar-header [(view)]="view" [(viewDate)]="viewDate">
  </app-calendar-header>

  <div [ngSwitch]="view" class="mt-3 calendar-container" *ngIf="events$ | async as events">
    <mwl-calendar-month-view
      *ngSwitchCase="CalendarView.Month"
      [viewDate]="viewDate"
      [events]="events"
      [weekStartsOn]="1"
      (dayClicked)="dayClicked($event.day)"
      (eventClicked)="editEvent($any($event.event))"
      [activeDayIsOpen]="activeDayIsOpen"
    ></mwl-calendar-month-view>
    <mwl-calendar-week-view
      *ngSwitchCase="CalendarView.Week"
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="editEvent($any($event.event))"
    ></mwl-calendar-week-view>
    <mwl-calendar-day-view
      *ngSwitchCase="CalendarView.Day"
      [viewDate]="viewDate"
      [events]="events"
      (eventClicked)="editEvent($any($event.event))"
      [dayStartHour]="8"
      [dayEndHour]="22"
    ></mwl-calendar-day-view>
  </div>

  <button
    pButton
    icon="pi pi-plus"
    class="p-button-lg p-button-rounded fab p-4 m-3 text-lg"
    (click)="open = true"
  ></button>

  <p-dialog appMaximized [(visible)]="open" [modal]="true" (onHide)="eventFormService.reset()">
    <div *pTemplate="'header'">
      Create event
    </div>
    <ng-container *ngIf="open">
      <app-event-view #content1 [event]="undefined"></app-event-view>
      <p-blockUI [target]="content1" [blocked]="loading">
        <p-progressSpinner></p-progressSpinner>
      </p-blockUI>
    </ng-container>
    <ng-template pTemplate="footer">
      <button pButton [label]="'Cancel'" [disabled]="loading" class="p-button-outlined" (click)="open = false"></button>
      <button pButton [label]="'Create'" [loading]="loading" (click)="createSpacedRep()"></button>
    </ng-template>
  </p-dialog>


  <p-dialog appMaximized [(visible)]="openEdit" [modal]="true" (onHide)="closeEditEvent()" (onShow)="showEditEvent()">
    <div *pTemplate="'header'" class="flex justify-content-between" [style.width]="'100%'">
      <span>Edit <span class="font-bold">{{editEventModel?.title}}</span> </span>
      <span *ngIf="autoSavingState">{{autoSavingState === 'saving' ? 'Auto saving...' : 'Auto-saved on '  + (lastAutoSave | date : 'M/d/yy, H:mm:ss')}}</span>
      <span class="pr-4">Repetition: {{editEventModel?.repetitionNumber}}</span>
    </div>
    <ng-container *ngIf="editEventModel">
      <app-event-view #content [event]="editEventModel"></app-event-view>
      <p-blockUI [target]="content" [blocked]="loading">
        <p-progressSpinner></p-progressSpinner>
      </p-blockUI>
    </ng-container>
    <ng-template pTemplate="footer">
      <button pButton [label]="'Delete'" [disabled]="loading" class="p-button-danger" [style.float]="'left'" (click)="confirmDeleteEvent()"></button>
      <button pButton [label]="'Close'" [disabled]="loading" class="p-button-outlined" (click)="openEdit = false"></button>
      <button pButton [label]="'Save'" [loading]="loading" (click)="saveEvent()"></button>
    </ng-template>
  </p-dialog>
</div>
<p-confirmDialog icon="pi pi-exclamation-triangle" header="Confirm" acceptButtonStyleClass="p-button-outlined" [defaultFocus]="'reject'"></p-confirmDialog>
